<div class="image-details-panel">
    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-section">
        <div class="placeholder-content">
            <i class="fas fa-spinner fa-spin placeholder-icon"></i>
            <p>{{ 'imageDetailPanel.loading' | translate }}</p>
        </div>
    </div>

    <!-- Error State -->
    <div *ngIf="loadingError && !isLoading" class="error-section">
        <div class="placeholder-content">
            <i class="fas fa-exclamation-triangle placeholder-icon error-icon"></i>
            <p>{{ loadingError }}</p>
        </div>
    </div>

    <!-- No Selection State -->
    <div *ngIf="!image && !isLoading && !loadingError" class="no-selection">
        <div class="placeholder-content">
            <i [class]="placeholderIcon + ' placeholder-icon'"></i>
            <p>{{ placeholderText }}</p>
        </div>
    </div>

    <!-- Image Details Content -->
    <div *ngIf="image" class="image-details-section">
        <h2>{{ title }}</h2>

        <!-- Editable Title Section -->
        <div class="image-title-section" *ngIf="showEditTitle">
            <div class="title-row" *ngIf="!editingTitle">
                <h3 class="image-title">{{ getDisplayTitle(image) }}</h3>
                <button type="button" class="edit-btn" (click)="startEditTitle()">
                    <i class="fas fa-edit"></i>
                </button>
            </div>
            <div class="title-edit-row" *ngIf="editingTitle">
                <input type="text"
                       class="title-input"
                       [(ngModel)]="editTitleValue"
                       (keyup.enter)="saveTitle()"
                       (keyup.escape)="cancelEditTitle()"
                       #titleInput>
                <button type="button" class="save-btn" (click)="saveTitle()">
                    <i class="fas fa-check"></i>
                </button>
                <button type="button" class="cancel-btn" (click)="cancelEditTitle()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>

        <!-- Compact Image Display -->
        <div class="image-display-compact">
            <div class="responsive-image-container" [ngClass]="getImageSizeClass()">
                <img [src]="imageBlobUrl"
                     [alt]="image.user_prompt || image.prompt || ('imageDetailPanel.alt.image' | translate)"
                     (error)="onImageError($event)"
                     loading="lazy"
                     class="responsive-image">
            </div>
        </div>

        <!-- Meta Info -->
        <div class="image-meta-info">
            <!-- ID Row (separate, full width) -->
            <div class="meta-id-row" *ngIf="shouldShowMetaInfo('id') && image.id">
                <div class="meta-item meta-item-id">
                    <i class="fas fa-fingerprint meta-icon"></i>
                    <span class="meta-value meta-id" [title]="image.id">{{ image.id }}</span>
                    <button type="button"
                            class="copy-id-btn"
                            (click)="copyToClipboard(image.id)"
                            [title]="'imageDetailPanel.copyId' | translate">
                        <i class="fas fa-copy"></i>
                    </button>
                </div>
            </div>

            <!-- Other Meta Data Grid -->
            <div class="meta-grid">
                <div class="meta-item" *ngIf="shouldShowMetaInfo('model') && image.model_used">
                    <i class="fas fa-robot meta-icon"></i>
                    <span class="meta-value">{{ image.model_used }}</span>
                </div>
                <div class="meta-item" *ngIf="shouldShowMetaInfo('size') && image.size">
                    <i class="fas fa-expand-arrows-alt meta-icon"></i>
                    <span class="meta-value">{{ image.size }}</span>
                </div>
                <div class="meta-item" *ngIf="shouldShowMetaInfo('created') && image.created_at">
                    <i class="fas fa-calendar meta-icon"></i>
                    <span class="meta-value">{{ formatDate(image.created_at) }}</span>
                </div>
            </div>
        </div>

        <!-- Prompt Details Expansion Panel -->
        <div class="expansion-panels" *ngIf="shouldShowPromptSection()">
            <details class="expansion-panel" open>
                <summary class="expansion-header">
                    <i class="fas fa-comment-dots"></i>
                    <span>{{ 'imageDetailPanel.prompts.title' | translate }}</span>
                </summary>
                <div class="expansion-content">
                    <!-- User Input Prompt -->
                    <div class="prompt-section" *ngIf="hasUserPrompt()">
                        <div class="prompt-label">
                            <i class="fas fa-user"></i>
                            {{ 'imageDetailPanel.prompts.userInput.label' | translate }}
                        </div>
                        <div class="prompt-text">{{ image.user_prompt }}</div>
                    </div>

                    <!-- AI Enhanced Prompt (Ollama) -->
                    <div class="prompt-section" *ngIf="image.prompt">
                        <div class="prompt-label">
                            <i class="fas fa-brain"></i>
                            {{ 'imageDetailPanel.prompts.aiEnhanced.label' | translate }}
                        </div>
                        <div class="prompt-text">{{ image.prompt }}</div>
                    </div>

                    <!-- Final Prompt (to DALL-E with Styles) -->
                    <div class="prompt-section" *ngIf="hasEnhancedPrompt()">
                        <div class="prompt-label">
                            <i class="fas fa-paper-plane"></i>
                            {{ 'imageDetailPanel.prompts.final.label' | translate }}
                        </div>
                        <div class="prompt-text-with-copy">
                            <div class="prompt-text">{{ image.enhanced_prompt }}</div>
                            <button type="button"
                                    class="copy-btn"
                                    (click)="copyToClipboard(image.enhanced_prompt!)"
                                    [title]="'imageDetailPanel.prompts.final.copy' | translate">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </details>
        </div>

        <!-- Style Selections Expansion Panel -->
        <div class="expansion-panels" *ngIf="hasManualStyles()">
            <details class="expansion-panel">
                <summary class="expansion-header">
                    <i class="fas fa-palette"></i>
                    <span>{{ 'imageDetailPanel.styles.title' | translate }}</span>
                </summary>
                <div class="expansion-content">
                    <div class="style-chips-container">
                        <div class="style-chip" *ngFor="let chip of getStyleChips()">
                            <span class="chip-label">{{ chip.label }}:</span>
                            <span class="chip-value">{{ chip.value }}</span>
                        </div>
                    </div>
                </div>
            </details>
        </div>

        <!-- Action Buttons Area -->
        <div class="detail-actions" *ngIf="showActionButtons">
            <div class="action-buttons">
                <button type="button" (click)="onDownloadOriginal()" class="action-btn download-btn">
                    <i class="fas fa-download"></i>
                    <span>{{ 'imageDetailPanel.actions.download' | translate }}</span>
                </button>
                <button type="button" (click)="onPreview()" class="action-btn preview-btn">
                    <i class="fas fa-expand"></i>
                    <span>{{ 'imageDetailPanel.actions.fullSize' | translate }}</span>
                </button>
            </div>
        </div>
    </div>
</div>
