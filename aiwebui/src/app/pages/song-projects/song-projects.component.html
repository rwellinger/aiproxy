<div class="song-projects-container master-detail-layout">
  <!-- Left Side: Project List -->
  <div class="list-section">
    <mat-card class="list-card">
      <!-- List Header -->
      <div class="list-header">
        <div class="header-title">
          <div class="header-title-group">
            <h2>
              <i class="fas fa-folder-open"></i>
              {{ 'songProjects.list.title' | translate }}
            </h2>
            <div class="projects-count-badge" *ngIf="totalProjects > 0">
              {{ totalProjects }}
            </div>
          </div>
          <p class="subtitle">{{ 'songProjects.list.subtitle' | translate }}</p>
        </div>
        <button
          type="button"
          class="new-project-button"
          (click)="createNewProject()"
          [matTooltip]="'songProjects.list.actions.new' | translate"
        >
          <i class="fas fa-plus"></i>
        </button>
      </div>

      <!-- Search -->
      <div class="filters-section">
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>{{ 'songProjects.list.search' | translate }}</mat-label>
          <input
            matInput
            [(ngModel)]="searchTerm"
            (ngModelChange)="onSearchChange($event)"
            [placeholder]="'songProjects.list.search' | translate"
          />
          <i class="fas fa-search" matPrefix></i>
        </mat-form-field>
      </div>

      <!-- Loading State -->
      <div *ngIf="isLoading" class="loading-container">
        <mat-spinner diameter="40"></mat-spinner>
        <p>{{ 'songProjects.list.loading' | translate }}</p>
      </div>

      <!-- Project List -->
      <div *ngIf="!isLoading" class="projects-list">
        <!-- Empty State -->
        <div *ngIf="projectList.length === 0" class="empty-state">
          <i class="fas fa-folder-open"></i>
          <p>{{ 'songProjects.list.empty' | translate }}</p>
        </div>

        <!-- Project Items -->
        <div
          *ngFor="let project of projectList"
          class="project-item"
          [class.selected]="selectedProject?.id === project.id"
          (click)="selectProject(project)"
        >
          <div class="project-item__header">
            <div class="icon">
              <i class="fas fa-folder"></i>
            </div>
            <div class="title-group">
              <h4>{{ project.project_name }}</h4>
              <span class="sync-badge" [ngClass]="getSyncStatusClass(project.sync_status)">
                {{ 'songProjects.syncStatus.' + project.sync_status | translate }}
              </span>
            </div>
          </div>

          <div class="project-item__tags" *ngIf="project.tags && project.tags.length > 0">
            <mat-chip-set>
              <mat-chip *ngFor="let tag of project.tags">{{ tag }}</mat-chip>
            </mat-chip-set>
          </div>

          <div class="project-item__footer">
            <span class="date">{{ project.updated_at | date:'short' }}</span>
          </div>
        </div>
      </div>

      <!-- Load More Button -->
      <div *ngIf="pagination.has_more && !isLoading" class="load-more-section">
        <button type="button" class="load-more-button" (click)="loadMore()">
          <span>{{ 'common.loadMore' | translate }}</span>
        </button>
      </div>
    </mat-card>
  </div>

  <!-- Right Side: Project Detail -->
  <div class="detail-section">
    <mat-card class="detail-card">
      <!-- Detail Loading State -->
      <div *ngIf="isLoadingDetail" class="loading-container">
        <mat-spinner diameter="40"></mat-spinner>
        <p>{{ 'songProjects.editor.loading' | translate }}</p>
      </div>

      <!-- No Selection State -->
      <div *ngIf="!selectedProject && !isLoadingDetail" class="empty-state">
        <i class="fas fa-folder-open"></i>
        <p>{{ 'songProjects.list.selectPrompt' | translate }}</p>
      </div>

      <!-- Project Details -->
      <div *ngIf="selectedProject && !isLoadingDetail" class="detail-content">
        <!-- Detail Header -->
        <div class="detail-header">
          <div class="header-title">
            <i class="fas fa-folder-open"></i>
            <h2>{{ selectedProject.project_name }}</h2>
          </div>
          <span class="sync-badge" [ngClass]="getSyncStatusClass(selectedProject.sync_status)">
            {{ 'songProjects.syncStatus.' + selectedProject.sync_status | translate }}
          </span>
        </div>

        <!-- Project Stats -->
        <div class="detail-section-block">
          <h3 class="section-title">
            <i class="fas fa-chart-bar"></i>
            {{ 'songProjects.detail.sections.metadata' | translate }}
          </h3>

          <div class="detail-field-row-3col">
            <div class="detail-field">
              <span class="field-label">{{ 'songProjects.detail.stats.totalFiles' | translate }}</span>
              <div class="readonly-field">{{ selectedProject.total_files }}</div>
            </div>

            <div class="detail-field">
              <span class="field-label">{{ 'songProjects.detail.stats.totalSize' | translate }}</span>
              <div class="readonly-field">{{ formatFileSize(selectedProject.total_size_bytes) }}</div>
            </div>

            <div class="detail-field">
              <span class="field-label">{{ 'songProjects.detail.stats.syncStatus' | translate }}</span>
              <div class="readonly-field">
                {{ 'songProjects.syncStatus.' + selectedProject.sync_status | translate }}
              </div>
            </div>
          </div>

          <div class="detail-field-row">
            <div class="detail-field">
              <span class="field-label">{{ 'songProjects.detail.stats.created' | translate }}</span>
              <div class="readonly-field">{{ selectedProject.created_at | date:'medium' }}</div>
            </div>

            <div class="detail-field">
              <span class="field-label">{{ 'songProjects.detail.stats.updated' | translate }}</span>
              <div class="readonly-field">{{ selectedProject.updated_at | date:'medium' }}</div>
            </div>
          </div>

          <!-- Tags -->
          <div class="detail-field" *ngIf="selectedProject.tags && selectedProject.tags.length > 0">
            <span class="field-label">{{ 'songProjects.editor.tags' | translate }}</span>
            <div class="readonly-field">
              <mat-chip-set>
                <mat-chip *ngFor="let tag of selectedProject.tags">{{ tag }}</mat-chip>
              </mat-chip-set>
            </div>
          </div>
        </div>

        <!-- Folders & Files -->
        <div class="detail-section-block">
          <h3 class="section-title">
            <i class="fas fa-folder"></i>
            {{ 'songProjects.detail.sections.files' | translate }}
          </h3>

          <!-- Folders Accordion -->
          <mat-accordion *ngIf="selectedProject.folders && selectedProject.folders.length > 0">
            <mat-expansion-panel *ngFor="let folder of selectedProject.folders">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <i class="fas fa-folder"></i>
                  <span>{{ folder.folder_name }}</span>
                  <span class="file-count">({{ folder.files.length || 0 }} files)</span>
                </mat-panel-title>
              </mat-expansion-panel-header>

              <!-- Files in Folder -->
              <div class="folder-files">
                <!-- Upload Button -->
                <div class="folder-upload-section">
                  <button
                    type="button"
                    class="upload-button"
                    (click)="uploadFile(folder)"
                  >
                    <i class="fas fa-upload"></i>
                    <span>{{ 'songProjects.detail.actions.uploadFile' | translate }}</span>
                  </button>
                </div>

                <div *ngIf="!folder.files || folder.files.length === 0" class="empty-folder">
                  <p>{{ 'songProjects.detail.noFiles' | translate }}</p>
                </div>

                <div *ngFor="let file of folder.files" class="file-item">
                  <div class="file-info">
                    <i class="fas fa-file"></i>
                    <span class="filename">{{ file.filename }}</span>
                    <span class="filesize">{{ formatFileSize(file.file_size_bytes) }}</span>
                  </div>
                  <button
                    *ngIf="file.download_url"
                    type="button"
                    class="file-download-button"
                    (click)="downloadFile(file.download_url!)"
                  >
                    <i class="fas fa-download"></i>
                  </button>
                </div>
              </div>
            </mat-expansion-panel>
          </mat-accordion>

          <div *ngIf="!selectedProject.folders || selectedProject.folders.length === 0" class="empty-folder">
            <p>{{ 'songProjects.detail.noFiles' | translate }}</p>
          </div>
        </div>

        <!-- Detail Actions -->
        <div class="detail-actions">
          <button type="button" class="action-button delete-button" (click)="deleteProject()">
            <i class="fas fa-trash"></i>
            <span>{{ 'songProjects.list.actions.delete' | translate }}</span>
          </button>
        </div>
      </div>
    </mat-card>
  </div>
</div>
